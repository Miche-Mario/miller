var MillerElectric=MillerElectric||{};(function(n){MillerElectric.Newsletters={config:{IsUserLoggedIn:!1,NewslettersPageUrl:""},onNewsletterSignup:function(){var n=MillerElectric.Newsletters,t=GoogleRecaptcha.getSubmittingButton(),i=t.closest(".newsletter-signup-form");n.validateNewsletterSignupForm(i)&&n.reCaptchaValidate(t,n.processNewsletterSignup)},validateNewsletterSignupForm:function(n){var i=MillerElectric.Newsletters,t;return n.find(".error").hide(),t=!0,n.find(".firstName").val()||(n.find(".firstNameError").show(),n.find(".requiredFieldsError").show(),t=!1),n.find(".lastName").val()||(n.find(".lastNameError").show(),n.find(".requiredFieldsError").show(),t=!1),n.find(".email").val()||(n.find(".emailError").show(),n.find(".requiredFieldsError").show(),t=!1),n.find(".postalCode").val()||(n.find(".postalCodeError").show(),n.find(".requiredFieldsError").show(),t=!1),n.find(".country").val()||(n.find(".countryError").show(),n.find(".requiredFieldsError").show(),t=!1),n.find("input[type='checkbox']:checked").length<1&&(n.find(".newslettersError").show(),n.find(".requiredNewsletterError").show(),t=!1),n.find(".email").val()!==n.find(".emailConfirm").val()&&(n.find(".emailError").show(),n.find(".emailConfirmError").show(),n.find(".emailAddressMatchError").show(),t=!1),t},reCaptchaValidate:function(t,i){var r=t.closest(".newsletter-signup-form"),u=r.find(".miller-button"),f=n(".recaptcha-container").find("#g-Recaptcha-Response").val();u.css("visibility","hidden"),n('<div class="miller-button wait-button gold disabled"><span>Please Wait<\/span><\/div>').insertBefore(n(".newsletter-sign-up-button")),n.ajax({type:"POST",url:"/api/recaptcha/validate",data:"="+f,dataType:"json",success:function(){i(r)},error:function(n){if(n.status==400){var t=JSON.parse(n.responseText);t.Message!=""&&(r.find(".unknownError").html(t.Message).show(),u.closest(".newsletter-signup-form").find(".wait-button").remove(),u.css("visibility","visible"))}else r.find(".unknownError").show()}})},processNewsletterSignup:function(t){var u=MillerElectric.Newsletters,i={},r;i.Selected=[],t.find("input[name='newsletter']:checked").each(function(t,r){i.Selected[i.Selected.length]=n(r).val()}),i.FirstName=t.find(".firstName").val(),i.LastName=t.find(".lastName").val(),i.Email=t.find(".email").val(),i.PostalCode=t.find(".postalCode").val(),i.Country=t.find(".country").val(),i.ReCaptchaResponse=n(".recaptcha-container").find("#g-Recaptcha-Response").val(),i.Source=window.location.pathname,i.IsNewContact=!0,r=t.find(".miller-button"),r.css("visibility","hidden"),n('<div class="miller-button wait-button gold disabled"><span>Please Wait<\/span><\/div>').insertBefore(n(".newsletter-sign-up-button")),n.ajax({type:"POST",url:"/api/gigya/SubmitCRMNewsletter",data:i,dataType:"json",async:!0,success:function(){ActiveCommerce.App.Analytics.pushTagEvent("me-newsletter"),t.hide(),t.next(".newsletters-confirmation").show()},error:function(n){if(n.status==400){var i=JSON.parse(n.responseText);i.Message!=""&&(t.find(".unknownError").html(i.Message).show(),r.closest(".newsletter-signup-form").find(".wait-button").remove(),r.css("visibility","visible"))}else t.find(".unknownError").show()}})}}})(jQuery)